Td-agent
========

This role deploys td-agent also known as "fluentd" on server. Td-agent will run as aggregator to collect logs from td-agent-bit running on servers. Please refer to the dispatch options available in this role.

| Dispatch | Description |
|:--------:|:-----------:|
| deploy-as-log-aggregator | Install and run td-agent as aggregator |
| cleanup| Stop and Uninstall td-agent rpm and delete data,log and config directory |
| deploy-as-log-forwarder | Install and run td-agent as forwarder |
| deploy-input-config | Deploy td-agent input and output config |

Requirements
------------
3rd party td-agent-3.1.1-0.el7.x86_64.rpm which is stored at https://artifactory.trusted.visa.com/ovn-extra-el7/


Role Variables
--------------

| Variable | Default value | Description |
|:--------:|:-------------:|:-----------:|
| td_agent_forward_remote_port | 8998 | Td-agent forwarder to aggregator port |
| td_agent_forward_local_port | 8999 | Td-agent local forward port |
| td_agent_log_dir | /var/log/td-agent | Td-agent logging directory |
| td_agent_buffer_dir | /opt/app/td-agent/buffer/td | Logs will be buffered in file for resiliency |
| td_agent_rpm | https://artifactory.trusted.visa.com/ovn-extra-el7/td-agent-2.3.5-0.el7.x86_64.rpm | Full path to td-agent rpm |
| cleanup_td_agent_process | false | cleanup zombie td-agent processes
| td_agent_secure_forward | false | Flag to enable TLS between forwarder-aggregator


Dependencies
------------
None.


Example Playbook
----------------

```sh

    - name: install td_agent
      hosts: fluentd_aggregator
      gather_facts: yes
      roles:
         - { role: td_agent, dispatch: ['deploy'] }


```

Input Config Templates
----------------------
Td-agent will use the template configuration definition to process log files generated by multiple components. The list includes:
Collection Jobs, Cron, ElasticSearch, Erlang Services, Hadoop, Kafka, Nginx, Nomad Jobs, Syslog, vsFTP, VSS, xdc_sync and yummirror.   


License
-------
N/A


Author Information
------------------
Nilang Shah (nilshah@visa.com)

References
-----------
* [Fluentd overview](https://docs.treasuredata.com/articles/td-agent)
* [Fluentd documentation](https://docs.fluentd.org/v0.12/articles/quickstart)
* [OVN Logging Framework LTA](https://visawiki.trusted.visa.com/display/OVN/OVN+Logging+Framework+LTA)
