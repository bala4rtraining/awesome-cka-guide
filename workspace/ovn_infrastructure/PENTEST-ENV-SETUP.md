# Pen test environment setup

run the playbooks from the onv_infrastructure in the document order.  One can use the tsung to perform sanity check.

download the latest profile.tar and tsung.tar.gz from ovngit and copy to ovn_infrastructure/ansible\_ovn/files directory

You should perform 2FA against the firewall guarding the pentest inventory: 10.199.56.20 (port 259).
The reason.  Access to most TCP ports on the machines in the dev environments are generally blocked by a firewall.
The ssh port (22) is an exception and 2FA is not required for ssh access to the machines in the dev environment.

To install elasticsearch one must have the vault password saved in a file.  See below for as a reference on how to
run the command.

```bash
# 2 FA against the firewall
$ telnet 10.199.56.20  259

    Trying 10.199.56.20...
    Connected to fw73np02v1cp.visa.com.
    Escape character is '^]'.
    Check Point FireWall-1 Client Authentication Server running on fx73np02m5cpp
    User: <your_ntid>@idb
    password: **************
    User <your_ntid>@idb authenticated by Radius authentication

    Choose:
      (1) Standard Sign-on
      (2) Sign-off
      (3) Specific Sign-on
    Enter your choice: 1
    Connection closed by foreign host.

# run sanity check on the tsung machine
$ ssh sl73ovnapd117

# generate test data
$ cd /tmp/tsung/bin
$ /test_data generate /tmp/testdata 100 0

# import test data
$ ./test_data import /tmp/testdata ../priv/ovn_transactions.dets ../priv/ovn_members.dets

# edit ../priv/ovn-load.xml and change the lines to these values
#    <arrivalphase phase="1" duration="1" unit="minute">
#      <users arrivalrate="10" unit="second"></users>
#    </arrivalphase>

# run sanity test
$ ./tsung console
```

## first datacenter

```bash
ansible-playbook ansible_ovn/capture_vars_about_dc.yml -i config/pentest1.inventory -u root --private-key=~/.ssh/ovn_id_dev --extra-vars cluster_name=pentest1 --extra-vars=@config/pentest1.vars.yml

ansible-playbook ansible_zookeeper/site.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest2.vars.yml --extra-vars @/tmp/vars_about_pentest1.yml

ansible-playbook ansible_kafka/site.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev  --extra-vars @config/pentest2.vars.yml --extra-vars @/tmp/vars_about_pentest1.yml

ansible-playbook ansible_riak/site.yml -i config/pentest2.inventory -f 1 -u root --private-key=~/.ssh/ovn_id_dev

ansible-playbook ansible_ovn/deploy_profile.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev

ansible-playbook ansible_ovn/site.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest2.vars.yml  --extra-vars provision=true --extra-vars @/tmp/vars_about_pentest1.yml

ansible-playbook ansible_ovn/ha-proxy.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest2.vars.yml

ansible-playbook ansible_ovn/tsung.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest2.vars.yml

ansible-playbook ansible_ovn/deploy_elasticsearch.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest2.vars.yml --extra-vars=@config/pentest2.vars.secret.yml --vault-password-file=~/.ssh/vault-test

ansible-playbook ansible_ovn/graphite_grafana.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest2.vars.yml --extra-vars @/tmp/vars_about_pentest1.yml --extra-vars=@config/pentest2.vars.secret.yml --vault-password-file=~/.ssh/vault-test

ansible-playbook ansible_ovn/deploy_kibana.yml -i config/pentest2.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest2.vars.yml --extra-vars=@config/pentest2.vars.secret.yml --vault-password-file=~/.ssh/vault-test
```

## Second datacenter

```bash
ansible-playbook ansible_ovn/capture_vars_about_dc.yml -i config/pentest2.inventory -u root --private-key=~/.ssh/ovn_id_dev --extra-vars cluster_name=pentest2 --extra-vars=@config/pentest2.vars.yml

ansible-playbook ansible_zookeeper/site.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest1.vars.yml --extra-vars @/tmp/vars_about_pentest2.yml

ansible-playbook ansible_kafka/site.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev  --extra-vars @config/pentest1.vars.yml --extra-vars @/tmp/vars_about_pentest2.yml

ansible-playbook ansible_riak/site.yml -i config/pentest1.inventory -f 1 -u root --private-key=~/.ssh/ovn_id_dev

ansible-playbook ansible_ovn/deploy_profile.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev

ansible-playbook ansible_ovn/site.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest1.vars.yml --extra-vars provision=true --extra-vars @/tmp/vars_about_pentest2.yml

ansible-playbook ansible_ovn/ha-proxy.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest1.vars.yml

ansible-playbook ansible_ovn/tsung.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars @config/pentest1.vars.yml

ansible-playbook ansible_ovn/deploy_elasticsearch.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest1.vars.yml --extra-vars=@config/pentest1.vars.secret.yml --vault-password-file=~/.ssh/vault-test

ansible-playbook ansible_ovn/graphite_grafana.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest1.vars.yml --extra-vars @/tmp/vars_about_pentest2.yml --extra-vars=@config/pentest1.vars.secret.yml --vault-password-file=~/.ssh/vault-test

ansible-playbook ansible_ovn/deploy_kibana.yml -i config/pentest1.inventory -f 5 -u root --private-key=~/.ssh/ovn_id_dev --extra-vars=@config/pentest1.vars.yml --extra-vars=@config/pentest1.vars.secret.yml --vault-password-file=~/.ssh/vault-test
```